<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0" />
		<meta http-equiv="X-UA-Compatible" content="ie=edge" />
		<title>Scratch</title>
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.2/dist/css/bootstrap.min.css"
			rel="stylesheet"
			integrity="sha384-uWxY/CJNBR+1zjPWmfnSnVxwRheevXITnMqoEIeG1LJrdI0GlVs/9cVSyPYXdcSF"
			crossorigin="anonymous"
		/>
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css" />
		<link rel="stylesheet" type="text/css" href="general_control.css" />
	</head>
	<body>
		<div class="container mt-5">
			<div class="row justify-content-center">
				<div class="col-lg-6 rounded-3 p-3">
					<!-- <div class="col-lg-6 border rounded-3 p-3"> -->
					<form action="#" id="experimentForm" method="POST">
						<!-- OLD STYLE <h2>Example form</h2> -->
						<h2 class="text-center">Example form</h2>
						<div class="text-danger text-center py-3 lead" id="formError"></div>
						<div id="grid-container"></div>

						<!-- --------------------------------------------------------------------------------------
			Everything above is already there. This means in your blueprints, simply add input elements
				and other content like below.
			-------------------------------------------------------------------------------------- -->
						<style></style>
						<script
							src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
							integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
							crossorigin="anonymous"
						></script>
						<style></style>
						<p>
							You will now be seeing some questions, which we would like you to answer. Please assume that members A and C have been matched with each other and that C has contributed
							<b>2 points</b>.
						</p>

						<ol id="control-questions">
							<!-- DEFAULT INPUT CONTROL QUESTION TEMPLATE -->
							<li data-input-type="number">
								<!-- QUESTION TEXT -->
								<!-- Enter the control question in this lable tag -->
								<label class="form-label">How large would be A's payoff if A contributed 1? </label>
								<div class="input-group">
									<input required type="number" step=".01" class="form-control font-monospac" value="" />
									<button tabindex="-1" class="btn btn-secondary" type="button" data-bs-toggle="collapse">
										<i class="bi bi-info-circle"></i>
									</button>
								</div>
								<div class="collapse multi-collapse">
									<div class="card card-body mt-2">
										<!-- ADDITIONAL INFORMATION TEXT -->
										<!-- Enter the additional information for the control question in this p tag. 
											You can also add additional markup and not just plain text. -->
										<p>Additional information which explains the question in more detail</p>
										<div id="solution-info" class="d-none mt-2">
											<h5>Solution:</h5>

											<!-- SOLUTION INFORMATION TEXT -->
											<!-- Enter the solution for the control question in this div tag with the id of "solution-info".	
											You can also add additional markup and not just plain text. -->
											Lorem ipsum, dolor sit amet consectetur <span>Hello</span> adipisicing elit.
										</div>
									</div>
								</div>
							</li>
							<!-- DEFAULT TEXT INPUT CONTROL QUESTION TEMPLATE -->
							<li data-input-type="radio">
								<!-- QUESTION TEXT -->
								<!-- Enter the control question in this lable tag -->
								<label style="display: flex; align-items: center">
									How large would be A's payoff if A contributed 1?
									<a type="button" class="bi bi-info-circle-fill fs-3 text-secondary ms-auto px-2" style="margin-left: auto; margin-bottom: auto" data-bs-toggle="collapse"></a>
								</label>
								<div class="collapse multi-collapse">
									<div class="card card-body my-2">
										<p>Additional information which explains the question in more detail</p>
										<!-- ADDITIONAL INFORMATION TEXT -->
										<!-- Enter the additional information for the control question in this div tag with the id of "solution-info" 
											You can also add additional markup and not just plain text. -->
										<div id="solution-info" class="d-none mt-2">
											<h5>Solution:</h5>

											Lorem ipsum, dolor sit amet consectetur <span>Hello</span> adipisicing elit.
										</div>
									</div>
								</div>
								<div class="form-check">
									<input class="form-check-input" type="radio" value="3.2" />
									<label class="form-check-label w-100"> 3.2 </label>
									<!-- INVALID FEEDBACK TEXT -->
									<!-- Enter the feedback message in the div tags with the "invalid-feedback" class -->
									<div class="invalid-feedback">feedback text</div>
								</div>
								<div class="form-check">
									<input class="form-check-input" type="radio" value="2" />
									<label class="form-check-label w-100">2</label>
									<div class="invalid-feedback">feedback text</div>
								</div>
								<div class="form-check">
									<input class="form-check-input" type="radio" value="1" />
									<label class="form-check-label w-100">1</label>
									<div class="invalid-feedback">feedback text</div>
								</div>
								<div class="form-check">
									<input class="form-check-input" type="radio" value="0" />
									<label class="form-check-label w-100">0</label>
									<div class="invalid-feedback">feedback text</div>
								</div>
							</li>
							<li data-input-type="number">
								<label class="form-label">How large would be A's payoff if A contributed 1? </label>
								<div class="input-group">
									<input required type="number" step=".01" class="form-control font-monospac" value="" />
									<button tabindex="-1" class="btn btn-secondary" type="button" data-bs-toggle="collapse">
										<i class="bi bi-info-circle"></i>
									</button>
								</div>
								<div class="collapse multi-collapse">
									<div class="card card-body mt-2">
										<p>Additional information which explains the question in more detail</p>
										<div id="solution-info" class="d-none mt-2">
											<h5>Solution:</h5>

											Lorem ipsum, dolor sit amet consectetur <span>Hello</span> adipisicing elit.
										</div>
									</div>
								</div>
							</li>
							<li data-input-type="range">
								<label style="display: flex; align-items: center">
									How large would be A's payoff if A contributed 1?
									<a type="button" class="bi bi-info-circle-fill fs-3 text-secondary ms-auto px-2" style="margin-left: auto; margin-bottom: auto" data-bs-toggle="collapse"></a>
								</label>

								<div class="collapse multi-collapse">
									<div class="card card-body my-2">
										<p>Additional information which explains the question in more detail</p>
										<div id="solution-info" class="d-none mt-2">
											<h5>Solution:</h5>

											Lorem ipsum, dolor sit amet consectetur <span>Hello</span> adipisicing elit.
										</div>
									</div>
								</div>
								<div class="range-wrap">
									<input required type="range" class="pulse range form-range" min="10" max="121" />
									<div class="range-container">
										<output class="bubble"></output>
									</div>
								</div>
							</li>
							<li data-input-type="checkbox">
								<label style="display: flex; align-items: center">
									How large would be A's payoff if A contributed 1?
									<a type="button" class="bi bi-info-circle-fill fs-3 text-secondary ms-auto px-2" style="margin-left: auto; margin-bottom: auto" data-bs-toggle="collapse"></a>
								</label>
								<div class="collapse multi-collapse">
									<div class="card card-body my-2">
										<p>Additional information which explains the question in more detail</p>
										<div id="solution-info" class="d-none mt-2">
											<h5>Solution:</h5>

											Lorem ipsum, dolor sit amet consectetur <span>Hello</span> adipisicing elit.
										</div>
									</div>
								</div>
								<div class="form-check">
									<input class="form-check-input" type="checkbox" value="Bike" />
									<label class="form-check-label w-100">Bike</label>
									<div class="invalid-feedback">More example invalid feedback text</div>
								</div>
								<div class="form-check">
									<input class="form-check-input" type="checkbox" value="Car" />
									<label class="form-check-label w-100">Car</label>
									<div class="invalid-feedback">More example invalid feedback text</div>
								</div>
								<div class="form-check">
									<input class="form-check-input" type="checkbox" value="Bus" />
									<label class="form-check-label w-100">Bus</label>
									<div class="invalid-feedback">More example invalid feedback text</div>
								</div>
								<div class="form-check">
									<input class="form-check-input" type="checkbox" value="Boat" />
									<label class="form-check-label w-100">Boat</label>
									<div class="invalid-feedback">More example invalid feedback text</div>
								</div>
							</li>
							<li data-input-type="checkbox">
								<label style="display: flex; align-items: center">
									How large would be A's payoff if A contributed 1?
									<a type="button" class="bi bi-info-circle-fill fs-3 text-secondary ms-auto px-2" style="margin-left: auto; margin-bottom: auto" data-bs-toggle="collapse"></a>
								</label>
								<div class="collapse multi-collapse">
									<div class="card card-body my-2">
										<p>Additional information which explains the question in more detail</p>
										<div id="solution-info" class="d-none mt-2">
											<h5>Solution:</h5>

											Lorem ipsum, dolor sit amet consectetur <span>Hello</span> adipisicing elit.
										</div>
									</div>
								</div>
								<div class="form-check">
									<input class="form-check-input" type="checkbox" value="Bike" />
									<label class="form-check-label w-100">Bike</label>
									<div class="invalid-feedback">More example invalid feedback text</div>
								</div>
								<div class="form-check">
									<input class="form-check-input" type="checkbox" value="Car" />
									<label class="form-check-label w-100">Car</label>
									<div class="invalid-feedback">More example invalid feedback text</div>
								</div>
								<div class="form-check">
									<input class="form-check-input" type="checkbox" value="Bus" />
									<label class="form-check-label w-100">Bus</label>
									<div class="invalid-feedback">More example invalid feedback text</div>
								</div>
								<div class="form-check">
									<input class="form-check-input" type="checkbox" value="Boat" />
									<label class="form-check-label w-100">Boat</label>
									<div class="invalid-feedback">More example invalid feedback text</div>
								</div>
							</li>
							<!-- <li data-input-type="textarea">
								<label id="question" style="display: flex; align-items: center">
									How large would be A's payoff if A contributed 1?
									<a type="button" class="bi bi-info-circle fs-3 text-secondary ms-auto ps-3" style="margin-left: auto; margin-bottom: auto" data-bs-toggle="collapse"></a>
								</label>
								<div class="collapse multi-collapse" id="collapse-control2-info">
									<div class="card card-body my-2">
										<p>Additional information which explains the question in more detail</p>
										<div id="solution-info" class="d-none mt-2">
											<h5>Solution:</h5>
											
											Lorem ipsum, dolor sit amet consectetur <span>Hello</span> adipisicing elit.
										</div>
									</div>
								</div>
								<div class="input-group">
									<textarea required class="form-control font-monospac" value=""></textarea>
								</div>
							</li> -->
							<!-- <li data-input-type="text">
								<label class="form-label">How large would be A's payoff if A contributed 1? </label>
								<div class="input-group">
									<input required type="text" class="form-control font-monospac" value="" />
									<button tabindex="-1" class="btn btn-secondary" type="button" data-bs-toggle="collapse">
										<i class="bi bi-info-circle"></i>
									</button>
								</div>
								<div class="collapse multi-collapse">
									<div class="card card-body mt-2">
										<p>Additional information which explains the question in more detail</p>
										<div id="solution-info" class="d-none mt-2">
											<h5>Solution:</h5>

											Lorem ipsum, dolor sit amet consectetur <span>Hello</span> adipisicing elit.
										</div>
									</div>
								</div>
							</li> -->
							<!-- <li data-input-type="select">
								<label style="display: flex; align-items: center">
									How large would be A's payoff if A contributed 1?
									<a type="button" class="bi bi-info-circle-fill fs-3 text-secondary ms-auto px-2" style="margin-left: auto; margin-bottom: auto" data-bs-toggle="collapse"></a>
								</label>
								<div class="collapse multi-collapse">
									<div class="card card-body my-2">
										<p>Additional information which explains the question in more detail</p>
										<div id="solution-info" class="d-none mt-2">
											<h5>Solution:</h5>

											Lorem ipsum, dolor sit amet consectetur <span>Hello</span> adipisicing elit.
										</div>
									</div>
								</div>
								<select class="form-select">
									<option value="" disabled selected>Select your option</option>
									<option value="1">One</option>
									<option value="2">Two</option>
									<option value="40">40</option>
								</select>
							</li> -->
							<!-- <li data-input-type="range">
								<label style="display: flex; align-items: center">
									How large would be A's payoff if A contributed 1?
									<a type="button" class="bi bi-info-circle-fill fs-3 text-secondary ms-auto px-2" style="margin-left: auto; margin-bottom: auto" data-bs-toggle="collapse"></a>
								</label>

								<div class="collapse multi-collapse">
									<div class="card card-body my-2">
										<p>Additional information which explains the question in more detail</p>
										<div id="solution-info" class="d-none mt-2">
											<h5>Solution:</h5>

											Lorem ipsum, dolor sit amet consectetur <span>Hello</span> adipisicing elit.
										</div>
									</div>
								</div>
								<div class="range-wrap">
									<input required type="range" class="pulse range form-range" min="10" max="121" />
									<div class="range-container">
										<output class="bubble"></output>
									</div>
								</div>
							</li> -->
						</ol>
						<div id="experiment-data" data-submitcount="1"></div>

						<!-- Solution Info Modal -->
						<div class="modal fade" id="solution-modal" tabindex="-1" aria-labelledby="solution-modal-label" aria-hidden="true">
							<div class="modal-dialog">
								<div class="modal-content">
									<div class="modal-header">
										<h5 class="modal-title" id="exampleModalLabel">Solution Information</h5>
										<button tabindex="-1" type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
									</div>
									<div class="modal-body">
										You answered a question incorrectly three times. You will now be shown the solutions to the questions. Read through the information provided in the info boxes
										and enter the correct answers into the input fields. Only if you answer all questions correctly you can proceed to the next page.
									</div>
									<div class="modal-footer">
										<button tabindex="-1" type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
									</div>
								</div>
							</div>
						</div>
						<script src="./general_control.js"></script>

						<!-- --------------------------------------------------------------------------------------
				Your blueprint would end here. Everything below is already there.
			-------------------------------------------------------------------------------------- -->

						<div class="mb-3 d-flex justify-content-end">
							<button type="button" id="submit-button" class="btn btn-outline-primary">Submit</button>
						</div>
					</form>
				</div>
			</div>

			<script>
				// params - json string containing parameters, for example
				// {"endowment": 17, "social_multiplier": 0.314}
				const params = {
					test_value: 10,
					multiplier: 1000,
				};

				console.log(params["test_value"]);
				window.onload = (event) => {
					for (const paramName in params) {
						let paramElements = document.querySelectorAll(`.${paramName}`);
						for (const paramElem of paramElements) {
							if (paramElem === null) continue;
							paramElem.innerText = `${params[paramName]}`;
						}
					}
				};
				// Simulation of the asynchronous XHR
				setTimeout(() => {
					onPageLoad(null, params);
					console.log("Parameters loaded");
				}, 400);

				document.querySelector("#submit-button").addEventListener("click", (event) => {
					// TODO: Add support for more input types, e.g., select
					// Read input values from event object and add them to inputValues
					const inputValues = {};

					// Selects text, number, range inputs
					let inputElements = document.querySelectorAll("input");
					// Selects select-dropdown inputs
					let selectElemets = document.querySelectorAll("select");
					// Selects textare inputs
					let textareaElements = document.querySelectorAll("textarea");
					const inputDataElements = [].concat(...inputElements, ...selectElemets, ...textareaElements);

					let anyInputInvalid = false;
					for (const inputElem of inputDataElements) {
						if (!inputElem.reportValidity()) {
							anyInputInvalid = true;
						}
					}

					if (!anyInputInvalid) {
						for (const inputElem of inputDataElements) {
							// Only add inputs with a name
							if (inputElem?.name === "") continue;

							inputElemType = inputElem.getAttribute("type");

							// If input is radio/checkbox
							if (inputElemType == "radio" || inputElemType == "checkbox") {
								// Only add radio/checkbox if it is checked
								if (!inputElem.checked) {
									continue;
								}
								inputValues[inputElem.name] = inputElem.value;
							}
							inputValues[inputElem.name] = inputElem.value;
						}
						console.log("inputValues", inputValues);
						let valid = customValidateForm(inputValues, params);
						if (!valid) {
							console.log("submit not successful");
						} else {
							// Submit is successful and user is redirected to next page
							// This is simulated with a page reload
							// window.location.reload();
						}
					} else {
						console.log("submit not successful");
					}
				});

				// // params - json string containing parameters, for example
				// // {"endowment": 17, "social_multiplier": 0.314}
				// const params = {
				// 	endowment: 2,
				// 	socialMultiplier: 0.6,
				// };

				// // Simulation of the asynchronous XHR
				// setTimeout(() => {
				// 	onPageLoad(null, params);
				// 	console.log("Parameters loaded");
				// }, 400);

				// document.querySelector("#submit-button").addEventListener("click", (event) => {
				// 	// TODO: Add support for more input types, e.g., select
				// 	// Read input values from event object and add them to inputValues
				// 	const inputValues = {};

				// 	let inputElements = document.querySelectorAll("input");

				// 	for (let inputElem of inputElements) {
				// 		// Only add inputs with a name
				// 		if (inputElem?.name !== "") {
				// 			inputElemType = inputElem?.attributes["type"]["nodeValue"];
				// 			// If input is radio/checkbox
				// 			if (inputElemType == "radio" || inputElemType == "checkbox") {
				// 				// Only add radio/checkbox if it is checked
				// 				if (inputElem.checked) {
				// 					inputValues[inputElem.name] = inputElem.value;
				// 				} else {
				// 					continue;
				// 				}
				// 			}
				// 			inputValues[inputElem.name] = inputElem.value;
				// 		}
				// 	}

				// 	console.log("inputValues", inputValues);
				// 	let valid = customValidateForm(inputValues, params);
				// 	if (!valid) {
				// 		console.log("submit not successful");
				// 	} else {
				// 		// Submit is successful and user is redirected to next page:
				// 		// This is simulated with a page reload
				// 		// window.location.reload();
				// 	}
				// });
			</script>
		</div>
	</body>
</html>
